<app-navbar></app-navbar>

<section class="page">
  <!-- =========================================================
       EN-TÊTE
       ========================================================= -->
  <header class="header">
    <h1>Réserver un véhicule d’entreprise</h1>
  </header>

  <!-- =========================================================
       FILTRES / PLAGE DE DATES
       ========================================================= -->
  <div class="filters">
    <!-- Date & heure de début -->
    <label class="field">
      <span>Date début :</span>

      <input
        type="date"
        [value]="dateDebutStr()"
        (change)="dateDebutStr.set($event.target.value)" />

      <span class="label">Heure de début :</span>
      <select #tdeb [value]="timeDebutStr()" (change)="timeDebutStr.set(tdeb.value)">
        @for (heure of HEURES; track $index) {
          <option [value]="heure" [selected]="heure === timeDebutStr()">{{ heure }}</option>
        }
      </select>
    </label>

    <!-- Date & heure de fin -->
    <label class="field">
      <span>Date fin</span>

      <input
        type="date"
        [value]="dateFinStr()"
        (change)="dateFinStr.set($event.target.value)" />

      <span class="label">Heure de fin :</span>
      <select #tfin [value]="timeFinStr()" (change)="timeFinStr.set(tfin.value)">
        @for (heure of HEURES; track $index) {
          <option [value]="heure" [selected]="heure === timeFinStr()">{{ heure }}</option>
        }
      </select>
    </label>

    <!-- Avertissements de validation -->
    @if (warnMsg()) {
      <p class="warn">{{ warnMsg() }}</p>
    }
  </div>

  <!-- =========================================================
       SLIDESHOW DES VÉHICULES (Swiper)
       ========================================================= -->
  <swiper-container
    #sc
    class="vehicules-swiper"
    init="false"
    navigation="true"
    pagination="true"
    keyboard="true"
    style="--swiper-navigation-color:#222; --swiper-pagination-color:#222; width:100%; height:auto;"
  >
    <!-- Cas avec résultats -->
    @if (vehiculesDisponible().length > 0) {
      @for (vehicule of vehiculesDisponible(); track vehicule.id ?? $index) {
        <swiper-slide>
          <article class="card">
            <!-- En-tête carte -->
            <header class="card-header">
              <h3>{{ vehicule.marque }} {{ vehicule.modele }}</h3>
              <span class="immat">{{ vehicule.immatriculation }}</span>
            </header>

            <!-- Corps carte -->
            <div class="card-body">
              <!-- Photo du véhicule -->
              <img
                class="photo"
                [src]="vehicule.photo || 'https://placehold.co/640x360?text=Photo'"
                alt="Photo du véhicule"
                loading="lazy"
              />

              <!-- Caractéristiques (affichage vertical, 1 info par ligne) -->
              <div style="display:flex; flex-direction:column; gap:8px; color:var(--ink-700);">
                <p style="margin:0; line-height:1.35;">
                  <strong style="color:var(--ink-900); display:inline-block; min-width:130px;">Catégorie :</strong>
                  <span style="word-break:break-word; white-space:normal;">
                    {{ vehicule.categorie ?? '—' }}
                  </span>
                </p>

                <p style="margin:0; line-height:1.35;">
                  <strong style="color:var(--ink-900); display:inline-block; min-width:130px;">Motorisation :</strong>
                  <span style="word-break:break-word; white-space:normal;">
                    {{ vehicule.motorisation ?? '—' }}
                  </span>
                </p>

                <p style="margin:0; line-height:1.35;">
                  <strong style="color:var(--ink-900); display:inline-block; min-width:130px;">CO₂ :</strong>
                  <span style="word-break:break-word; white-space:normal;">
                    {{ vehicule.co2ParKm ?? '—' }}
                  </span>
                </p>

                <p style="margin:0; line-height:1.35;">
                  <strong style="color:var(--ink-900); display:inline-block; min-width:130px;">Places :</strong>
                  <span style="word-break:break-word; white-space:normal;">
                    {{ vehicule.nbPlaces }}
                  </span>
                </p>
              </div>
            </div>

            <!-- Pied de carte -->
            <footer class="card-footer">
              <button
                type="button"
                class="btn"
                [disabled]="!canReserve()"
                (click)="openConfirmReserve(vehicule)"
              >
                Réserver
              </button>
            </footer>
          </article>
        </swiper-slide>
      }
    }
    <!-- Cas sans résultats -->
    @else {
      <swiper-slide>
        <div class="empty">Aucun véhicule disponible pour ces dates.</div>
      </swiper-slide>
    }
  </swiper-container>
</section>

<!-- =========================================================
     MODALE DE CONFIRMATION
     ========================================================= -->
<app-confirm-dialog
  [open]="confirmOpen()"
  [title]="confirmTitle()"
  [message]="confirmMessage()"
  confirmLabel="Confirmer"
  cancelLabel="Annuler"
  (confirm)="confirmReserve()"
  (cancel)="cancelReserve()"
>
</app-confirm-dialog>

<app-footer></app-footer>
