<app-navbar></app-navbar>

<section class="page">
    <header class="header">
        <h1>Réserver un véhicule d’entreprise</h1>
    </header>
    <!-- filtres / sélection de plage -->
    <div class="filters">
        <label class="field">
            <span>Date début :</span>
            <input type="date" [value]="dateDebutStr()" (change)="dateDebutStr.set($event.target.value)">

            <span class="label">Heure de début :</span>
            <select #tdeb [value]="timeDebutStr()" (change)="timeDebutStr.set(tdeb.value)">
                @for(heure of HEURES; track $index) {
                <option [value]="heure" [selected]="heure === timeDebutStr()">{{ heure }}</option>
                }
            </select>
        </label>

        <label class="field">
            <span>Date fin</span>
            <input type="date" [value]="dateFinStr()" (change)="dateFinStr.set($event.target.value)">

            <span class="label">Heure de fin :</span>
            <select #tfin [value]="timeFinStr()" (change)="timeFinStr.set(tfin.value)">
                @for(heure of HEURES; track $index) {
                <option [value]="heure" [selected]="heure === timeFinStr()">{{ heure }}</option>
                }
            </select>
        </label>

        @if (warnMsg()) {
        <p class="warn">{{ warnMsg() }}</p>
        }
    </div>
    @if (loading()) {
    <p class="muted">Chargement…</p>
    } @else {
    <swiper-container navigation="true" pagination="true" keyboard="true" space-between="16" slides-per-view="1"
        style="--swiper-navigation-color:#222; --swiper-pagination-color:#222; width:100%; height:auto;">
        @for (vehicule of vehiculesDisponible(); track vehicule.id ?? $index) {
        <swiper-slide>
            <article class="card">
                <header class="card-header">
                    <h3>{{ vehicule.marque }} {{ vehicule.modele }}</h3>
                    <span class="immat">{{ vehicule.immatriculation }}</span>
                </header>

                <div class="card-body">
                    <img class="photo" [src]="vehicule.photo || 'https://placehold.co/640x360?text=Photo'"
                        alt="Photo du véhicule" loading="lazy">
                    <ul class="props">
                        <li><strong>Places :</strong> {{ vehicule.nbPlaces }}</li>
                        <li><strong>Motorisation :</strong> {{ vehicule.motorisation ?? '—' }}</li>
                        <li><strong>CO₂ :</strong> {{ vehicule.co2ParKm ?? '—' }}</li>
                    </ul>
                </div>

                <footer class="card-footer">
                    <button type="button" class="btn" [disabled]="!canReserve()" (click)="openConfirmReserve(vehicule)">
                        Réserver
                    </button>
                </footer>
            </article>
        </swiper-slide>
        } @empty {
        <swiper-slide>
            <div class="empty">Aucun véhicule disponible pour ces dates.</div>
        </swiper-slide>
        }
    </swiper-container>
    }
</section>

<app-confirm-dialog [open]="confirmOpen()" [title]="confirmTitle()" [message]="confirmMessage()"
    confirmLabel="Confirmer" cancelLabel="Annuler" (confirm)="confirmReserve()" (cancel)="cancelReserve()">
</app-confirm-dialog>

<app-footer></app-footer>