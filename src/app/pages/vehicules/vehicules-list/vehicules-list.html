<app-navbar></app-navbar>

<div class="vehicules-page">

  <!-- MON VEHICULE PERSONNEL -->
  <section class="panel">
    <h2 class="panel__title">MON V√âHICULE PERSONNEL</h2>

    @if(vehiculePersoList() != null && vehiculePersoList().length > 0) {
    <div class="card">
      <table class="table table--vehicule">
        <thead>
          <tr>
            <th>Marque</th>
            <th>Mod√®le</th>
            <th>Immatriculation</th>
            <th>Nombre de places</th>
            <th>CO‚ÇÇ/km</th>
            <th>Cat√©gorie</th>
            <th>Motorisation</th>
            <th>Photo</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for(vehiculePerso of vehiculePersoList(); track vehiculePerso.id ?? $index) {
          <tr>
            <td>{{ vehiculePerso?.marque || '‚Äî' }}</td>
            <td>{{ vehiculePerso?.modele || '‚Äî' }}</td>
            <td class="immat">{{ vehiculePerso?.immatriculation || '‚Äî' }}</td>
            <td>{{ vehiculePerso?.nbPlaces || '‚Äî' }}</td>
            <td>{{ vehiculePerso?.co2ParKm || '‚Äî' }}</td>
            <td>{{ vehiculePerso?.categorie || '‚Äî' }}</td>
            <td>{{ vehiculePerso?.motorisation || '‚Äî' }}</td>
            <td class="photo-cell">
              <img [src]="vehiculePerso?.photo || 'https://placehold.co/72x48?text=Photo'" alt="Photo v√©hicule"
                class="thumb" loading="lazy" />
            </td>
            <td class="actions-col">
              <button type="button" class="icon-btn" title="modifier" (click)="openEditVehicule(vehiculePerso)">
                <i class="icon-edit">‚úèÔ∏è</i>
              </button>
              <button type="button" class="icon-btn" title="Supprimer" (click)="openSuppression(vehiculePerso)">
                <i class="icon-delete">üóëÔ∏è</i>
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <div class="card empty-personal">
      <p>Vous n‚Äôavez pas encore de v√©hicule personnel.</p>
      <div class="cta">
        <button type="button" class="btn-primary" (click)="openCreationVehicule()">
          Ajouter mon v√©hicule
        </button>
      </div>
    </div>
    }
  </section>


  <!-- MES R√âSERVATIONS DE V√âHICULES DE SOCI√âT√â -->
  <section class="panel">
    <h2 class="panel__title">MES R√âSERVATIONS DE V√âHICULES DE SOCI√âT√â</h2>

    <div class="card">
      <table class="table table--reservations">
        <thead>
          <tr>
            <th>Marque</th>
            <th>Mod√®le</th>
            <th>Immatriculation</th>
            <th>Nombre de places</th>
            <th>CO‚ÇÇ/km</th>
            <th>Cat√©gorie</th>
            <th>Motorisation</th>
            <th>Photo</th>
            <th>Date de d√©but</th>
            <th>Date de fin</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for(row of pagedReservations(); track row.id ?? $index){
          <tr [class.row--current]="isCurrent(row)" [class.row--past]="isPast(row)">
            <td>{{ row.vehicule?.marque ?? '‚Äî' }}</td>
            <td>{{ row.vehicule?.modele ?? '‚Äî' }}</td>
            <td class="immat">{{ row.vehicule?.immatriculation ?? '‚Äî' }}</td>
            <td>{{ row.vehicule?.nbPlaces ?? '‚Äî' }}</td>
            <td>{{ row.vehicule?.co2ParKm ?? '‚Äî' }}</td>
            <td>{{ row.vehicule?.categorie ?? '‚Äî' }}</td>
            <td>{{ row.vehicule?.motorisation ?? '‚Äî' }}</td>
            <td class="photo-cell">
              <img [src]="row.vehicule?.photo || 'https://placehold.co/72x48?text=Photo'" alt="Photo v√©hicule"
                class="thumb" loading="lazy" />
            </td>
            <td>
              <time [attr.datetime]="row.dateDebut">{{ row.dateDebut | date:'dd/MM/yyyy HH:mm' }}</time>
            </td>
            <td>
              <time [attr.datetime]="row.dateFin">{{ row.dateFin | date:'dd/MM/yyyy HH:mm' }}</time>
            </td>
            <td class="actions-col">
              @if (isUpcoming(row)) {
              <!-- r√©servations √† venir : annuler -->
              
              <button type="button" class="icon-btn" title="Annuler la r√©servation" (click)="openAnnulation(row)">
                <i class="icon-delete">üóëÔ∏è</i>
              </button>
              } @else if (isCurrent(row)) {
              <!-- r√©servation en cours : terminer -->
              <button type="button" class="icon-btn" title="Terminer la r√©servation" (click)="openFinalisation(row)">
                
                <i class="icon-delete">üóëÔ∏è</i>
              </button>
              } @else {
              <!-- r√©servations pass√©es : aucune action -->
              }
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="10" class="empty">Aucune r√©servation.</td>
          </tr>
          }
        </tbody>
      </table>
      <div class="pagination">
        <button type="button" class="pager" (click)="prevPage()" [disabled]="page() === 1">Pr√©c√©dent</button>
        <span class="pager__info">Page {{ page() }} / {{ totalPages() }}</span>
        <button type="button" class="pager" (click)="nextPage()" [disabled]="page() === totalPages()">Suivant</button>
      </div>
    </div>
  </section>

  <!-- CTA -->
  <div class="cta">
    <button type="button" class="btn-primary" (click)="goToReservation()">R√âSERVER UN V√âHICULE</button>
  </div>

</div>

<app-confirm-dialog [open]="!!reservationToDelete() || !!reservationToEdit() || !!vehiculePersoToDelete()" [title]="modaleTitle()"
  [message]="deleteContent()" confirmLabel="Supprimer" cancelLabel="Annuler" (confirm)="confirmModale()"
  (cancel)="closeModale()"></app-confirm-dialog>

@if(vehiculeToEdit(); as editing) {
<app-vehicule-edit [open]="!!vehiculeToEdit()" [model]="editing" [title]="modaleTitle()" (confirm)="onSaveEdit($event)"
  (cancel)="closeEdit()"></app-vehicule-edit>
}
@if(creationVehicule()) {
<app-vehicule-edit [open]="!!creationVehicule()" [title]="modaleTitle()" (confirm)="onSaveEdit($event)"
  (cancel)="closeEdit()"></app-vehicule-edit>
}

<app-footer></app-footer>