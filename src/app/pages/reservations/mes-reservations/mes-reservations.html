<div class="page-wrapper">
  <app-navbar></app-navbar>

  <main class="mes-reservations-container">
    <h1 class="page-title">MES R√âSERVATIONS</h1>

    <!-- Message d'erreur -->
    <div *ngIf="errorMessage" class="error-message">
      {{ errorMessage }}
    </div>

    <!-- Loader -->
    <div *ngIf="isLoading" class="loading-spinner">
      <div class="spinner"></div>
      <p>Chargement des r√©servations...</p>
    </div>

    <!-- Tableau des r√©servations -->
    <div *ngIf="!isLoading && reservations && reservations.length > 0" class="reservations-table-container">
      <table class="reservations-table">
        <thead>
        <tr>
          <th>Date de d√©part</th>
          <th>Adresse de d√©part</th>
          <th>Adresse d'arriv√©e</th>
          <th>Marque</th>
          <th>Mod√®le</th>
          <th>Photo</th>
          <th>Participants</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let reservation of pagedReservations">
          <td>{{ formatDateDepart(reservation.annonce.heureDepart) }}</td>
          <td>{{ formatAdresse(reservation.annonce.adresseDepart) }}</td>
          <td>{{ formatAdresse(reservation.annonce.adresseArrivee) }}</td>
          <td>{{ reservation.vehicule?.marque || 'Chargement...' }}</td>
          <td>{{ reservation.vehicule?.modele || 'Chargement...' }}</td>
          <td class="photo-cell">
            <img
              *ngIf="reservation.vehicule?.photo"
              [src]="reservation.vehicule?.photo"
              [alt]="(reservation.vehicule?.marque || '') + ' ' + (reservation.vehicule?.modele || '')"
              class="vehicle-photo">
            <span *ngIf="!reservation.vehicule?.photo" class="no-photo">üì∑</span>
          </td>
          <td>{{ getNombrePassagers(reservation) }}</td>
          <td class="actions-cell">
            <button
              class="action-btn info-btn"
              (click)="voirDetails(reservation)"
              title="Voir les d√©tails">
              <i class="icon-info">‚ÑπÔ∏è</i>
            </button>
            <button
              class="action-btn delete-btn"
              (click)="confirmerAnnulation(reservation)"
              title="Annuler la r√©servation">
              <i class="icon-delete">üóëÔ∏è</i>
            </button>
          </td>
        </tr>
        </tbody>
      </table>
      <div class="pagination">
        <button type="button" class="pager" (click)="prevPage()" [disabled]="currentPage === 1">Pr√©c√©dent</button>
        <span class="pager__info">Page {{ currentPage }} / {{ totalPages }}</span>
        <button type="button" class="pager" (click)="nextPage()" [disabled]="currentPage === totalPages">Suivant</button>
      </div>
    </div>

    <!-- Message si aucune r√©servation -->
    <div *ngIf="!isLoading && (!reservations || reservations.length === 0)" class="no-reservations">
      <p>Vous n'avez pas encore r√©serv√© de covoiturage.</p>
    </div>

    <!-- Bouton rechercher un covoiturage -->
    <div class="action-button-container">
      <button class="btn-rechercher-covoiturage" (click)="rechercherCovoiturage()">
        RECHERCHER UN COVOITURAGE
      </button>
    </div>
  </main>

  <app-footer></app-footer>
</div>

<!-- Modal de confirmation d'annulation (en dehors du wrapper) -->
<app-delete-confirmation-dialog
  [open]="showDeleteModal"
  [title]="'Confirmer l\'annulation'"
  [message]="'√ätes-vous s√ªr de vouloir annuler cette r√©servation ?'"
  [confirmLabel]="'Confirmer'"
  [cancelLabel]="'Annuler'"
  (confirm)="annulerReservation()"
  (cancel)="annulerSuppression()">
</app-delete-confirmation-dialog>

<!-- Modale de d√©tail de r√©servation (en dehors du wrapper) -->
<app-reservation-detail-modal
  [isOpen]="showDetailModal"
  [reservation]="selectedReservation"
  (close)="closeDetailModal()"
  (annuler)="onAnnulerReservation($event)">
</app-reservation-detail-modal>
