<section class="page">
    <header class="header">
        <h1>Réserver un véhicule d’entreprise</h1>
    </header>
    <!-- filtres / sélection de plage -->
    <div class="filters">
        <label class="field">
            <span>Date début :</span>
            <input type="date" [value]="dateDebutStr()" (change)="dateDebutStr.set($event.target.value)">

            <span class="label">Heure début :</span>
            <select #tdeb [value]="timeDebutStr()" (change)="timeDebutStr.set(tdeb.value)">
                @for(heure of HEURES; track $index) {
                <option [value]="heure" [selected]="heure === timeDebutStr()">{{ heure }}</option>
                }
            </select>
        </label>

        <label class="field">
            <span>Date fin</span>
            <input type="date" [value]="dateFinStr()" (change)="dateFinStr.set($event.target.value)">

            <span class="label">Heure début :</span>
            <select #tfin [value]="timeFinStr()" (change)="timeFinStr.set(tfin.value)">
                @for(heure of HEURES; track $index) {
                <option [value]="heure" [selected]="heure === timeFinStr()">{{ heure }}</option>
                }
            </select>
        </label>

        @if (warnMsg()) {
        <p class="warn">{{ warnMsg() }}</p>
        }
    </div>
    @if (loading()) {
    <p class="muted">Chargement…</p>
    } @else {
    <div class="table-wrap">
        <table class="table">
            <thead>
                <tr>
                    <th>Marque</th>
                    <th>Modèle</th>
                    <th class="immat">Immatriculation</th>
                    <th>Places</th>
                    <th>CO₂ (g/km)</th>
                    <th>Motorisation</th>
                    <th>Photo</th>
                    <th>Reserver</th>
                </tr>
            </thead>
            <tbody>
                @for (vehicule of vehiculesDisponible(); track vehicule.id ?? $index) {
                <tr>
                    <td>{{ vehicule.marque || '—' }}</td>
                    <td>{{ vehicule.modele || '—' }}</td>
                    <td class="immat">{{ vehicule.immatriculation || '—' }}</td>
                    <td>{{ vehicule.nbPlaces}}</td>
                    <td>{{ vehicule.co2ParKm ?? '—' }}</td>
                    <td>{{ vehicule.motorisation || '—' }}</td>
                    <td class="photo-cell">
                        <img [src]="vehicule.photo" alt="Photo véhicule" class="thumb" loading="lazy">
                    </td>
                    <td class="actions-col">
                        <button type="button" class="btn-reserver" [disabled]="!canReserve()"
                            (click)="openConfirmReserve(vehicule)">
                            Réserver
                        </button>
                    </td>

                </tr>
                } @empty {
                <tr>
                    <td colspan="7" class="empty">Aucun véhicule d’entreprise disponible.</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    }
</section>

<app-confirm-dialog [open]="confirmOpen()" [title]="confirmTitle()" [message]="confirmMessage()"
    confirmLabel="Confirmer" cancelLabel="Annuler" (confirm)="confirmReserve()" (cancel)="cancelReserve()">
</app-confirm-dialog>