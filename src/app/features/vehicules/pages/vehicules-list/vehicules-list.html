<div class="vehicules-page">

  <!-- MON VEHICULE PERSONNEL -->
  @if(vehiculePerso() != null) {
  <section class="panel">
    <h2 class="panel__title">MON VÉHICULE PERSONNEL</h2>

    <div class="card">
      <table class="table table--vehicule">
        <thead>
          <tr>
            <th>Marque</th>
            <th>Modèle</th>
            <th>Immatriculation</th>
            <th>Nombre de places</th>
            <th>CO2/km</th>
            <th>Motorisation</th>
            <th>Photo</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>{{ vehiculePerso()?.marque || '—' }}</td>
            <td>{{ vehiculePerso()?.modele || '—' }}</td>
            <td class="immat">{{ vehiculePerso()?.immatriculation || '—' }}</td>
            <td>{{ vehiculePerso()?.nbPlaces || '—' }}</td>
            <td>{{ vehiculePerso()?.co2ParKm || '—' }}</td>
            <td>{{ vehiculePerso()?.motorisation || '—' }}</td>
            <td class="photo-cell">
              <img [src]="vehiculePerso()?.photo || 'https://placehold.co/72x48?text=Photo'" alt="Photo véhicule"
                class="thumb" loading="lazy" />
            </td>
            <td class="actions-col">
              <!-- Bouton poubelle (placeholder) -->
              <button type="button" class="icon-btn" title="Supprimer (à implémenter)" disabled>
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9zM7 9h2v9H7V9z" />
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
  }


  <!-- MES RÉSERVATIONS DE VÉHICULES DE SOCIÉTÉ -->
  <section class="panel">
    <h2 class="panel__title">MES RÉSERVATIONS DE VÉHICULES DE SOCIÉTÉ</h2>

    <div class="card">
      <table class="table table--reservations">
        <thead>
          <tr>
            <th>Marque</th>
            <th>Modèle</th>
            <th>Immatriculation</th>
            <th>Nombre de places</th>
            <th>CO2/km</th>
            <th>Motorisation</th>
            <th>Photo</th>
            <th>Date de début</th>
            <th>Date de fin</th>
            <th class="actions-col">Actions</th>
          </tr>
        </thead>
        <tbody>
          @for(row of reservationRows(); track row.id ?? $index){
          <tr>
            <td>{{ row.vehicule?.marque ?? '—' }}</td>
            <td>{{ row.vehicule?.modele ?? '—' }}</td>
            <td class="immat">{{ row.vehicule?.immatriculation ?? '—' }}</td>
            <td>{{ row.vehicule?.nbPlaces ?? '—' }}</td>
            <td>{{ row.vehicule?.co2ParKm ?? '—' }}</td>
            <td>{{ row.vehicule?.motorisation ?? '—' }}</td>
            <td class="photo-cell">
              <img
                [src]="row.vehicule?.photo || 'https://placehold.co/72x48?text=Photo'"
                alt="Photo véhicule" class="thumb" loading="lazy" />
            </td>
            <td>
              <time [attr.datetime]="row.dateDebut">{{ row.dateDebut | date:'dd/MM/yyyy HH:mm' }}</time>
            </td>
            <td>
              <time [attr.datetime]="row.dateFin">{{ row.dateFin | date:'dd/MM/yyyy HH:mm' }}</time>
            </td>
            <td class="actions-col">
              <button type="button" class="icon-btn" title="Annuler la réservation" (click)="openAnnulation(row)">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9zM7 9h2v9H7V9z" />
                </svg>
              </button>
            </td>
          </tr>
          } @empty {
          <tr>
            <td colspan="10" class="empty">Aucune réservation.</td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </section>

  <!-- CTA -->
  <div class="cta">
    <button type="button" class="btn-primary">RÉSERVER UN VÉHICULE</button>
  </div>

</div>

<app-confirm-dialog
  [open]="!!reservationToDelete()"
  [title]="'Annuler la réservation'"
  [message]="
    selectedVehiculeForDelete()
      ? ('Voulez-vous annuler la réservation du véhicule ' +
         (selectedVehiculeForDelete()?.marque || '') + ' ' +
         (selectedVehiculeForDelete()?.modele || '') + ' ?')
      : 'Voulez-vous annuler cette réservation ?'
  "
  confirmLabel="Supprimer"
  cancelLabel="Annuler"
  (confirm)="confirmAnnulation()"
  (cancel)="cancelAnnulation()"
></app-confirm-dialog>
